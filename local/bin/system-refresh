#!/bin/bash
set -e

# Trap errors to provide debugging info
trap 'notify-send --urgency critical "System refresh failed: Command '\''$BASH_COMMAND'\'' exited with code $?"; exit 1' ERR

systemctl --user restart elephant.service
systemctl --user restart walker.service

# Restart mako if running (in background)
if pgrep -x mako >/dev/null; then
    pkill -x mako
    nohup uwsm app -- mako &>/dev/null &
fi

# Restart waybar if it is running (in background)
if pgrep -x waybar >/dev/null; then
    pkill waybar
    nohup waybar &>/dev/null &
fi

# reset hyprland
hyprctl reload

# Sync filesystem to ensure clean state
sync

notify-send "System has been refreshed!"
