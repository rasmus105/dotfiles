#!/bin/bash

# Parse options
ONLY_IF_RUNNING=false

while [[ $# -gt 0 ]]; do
    case $1 in
    --only-if-running)
        ONLY_IF_RUNNING=true
        shift
        ;;
    *)
        break
        ;;
    esac
done

# Check if app name is provided
if [ $# -eq 0 ]; then
    notify-send -u critical "system-restart-app" "No application name provided"
    exit 1
fi

APP_NAME="$1"
shift # Remove first argument, leaving optional args in $@

# Check if app is currently running
IS_RUNNING=false
if pgrep -x "$APP_NAME" >/dev/null; then
    IS_RUNNING=true
fi

# If --only-if-running is set and app is not running, exit silently
if [ "$ONLY_IF_RUNNING" = true ] && [ "$IS_RUNNING" = false ]; then
    exit 0
fi

# Kill the app if it's running
if [ "$IS_RUNNING" = true ]; then
    pkill -x "$APP_NAME"
fi

# Start the app with any additional arguments
setsid uwsm app -- "$APP_NAME" "$@" >/dev/null 2>&1 &
